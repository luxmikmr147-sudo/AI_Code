<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pick BASIC Modernizer</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 0; background: #f7f8fa; color: #1d2433; }
      .container { max-width: 1300px; margin: 30px auto; padding: 20px; }
      .card { background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,.08); padding: 20px; }
      .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
      textarea { width: 100%; min-height: 330px; padding: 10px; font-family: Consolas, monospace; font-size: 13px; }
      select, input, button { padding: 8px 10px; margin-right: 8px; }
      .toolbar { margin-bottom: 10px; display:flex; flex-wrap: wrap; gap: 8px; align-items:center; }
      button { background: #0d6efd; color: white; border: 0; border-radius: 6px; cursor: pointer; }
      button:hover { background: #0b5ed7; }
      .hint { color: #5f6b7a; font-size: 13px; }
      .meta { margin-top: 8px; font-size: 12px; color: #4c5970; }
      @media (max-width: 1000px) { .grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Pick BASIC Modernization Compiler</h1>
      <p class="hint">Paste Pick BASIC code, choose output mode and target language, then convert.</p>

      <div class="card">
        <div class="toolbar">
          <input id="programName" placeholder="Program name" value="WEB_INPUT" />
          <select id="mode">
            <option value="ir">IR only</option>
            <option value="architecture">Architecture only</option>
            <option value="code">Code only</option>
            <option value="full">Full transformation</option>
          </select>
          <select id="target">
            <option value="python">Python</option>
            <option value="c#">C#</option>
            <option value="java">Java</option>
            <option value="php">PHP</option>
          </select>
          <button id="convertBtn">Convert</button>
        </div>

        <div class="grid">
          <div>
            <h3>Source (Pick BASIC)</h3>
            <textarea id="sourceCode" placeholder="Paste Pick BASIC code here..."></textarea>
          </div>
          <div>
            <h3>Converted Output</h3>
            <textarea id="result" readonly placeholder="Generated output appears here..."></textarea>
          </div>
          <div>
            <h3>Extracted Business Rules & Logic</h3>
            <textarea id="rulesLogic" readonly placeholder="Extracted rules and logic will appear here..."></textarea>
            <div class="meta" id="meta"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const convertBtn = document.getElementById('convertBtn');
      const sourceCode = document.getElementById('sourceCode');
      const result = document.getElementById('result');
      const rulesLogic = document.getElementById('rulesLogic');
      const mode = document.getElementById('mode');
      const target = document.getElementById('target');
      const programName = document.getElementById('programName');
      const meta = document.getElementById('meta');

      sourceCode.value = `START:\nREAD REC FROM CUSTOMER,ID ELSE STOP\nIF REC<1> = '' THEN CRT 'MISSING'\nWRITE REC ON CUSTOMER,ID\nGOTO START`;

      convertBtn.addEventListener('click', async () => {
        result.value = 'Converting...';
        rulesLogic.value = 'Extracting business rules and logic...';
        meta.textContent = '';

        try {
          const response = await fetch('/api/convert', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              source_code: sourceCode.value,
              target_language: target.value,
              output_mode: mode.value,
              program_name: programName.value || 'WEB_INPUT'
            })
          });

          const data = await response.json();
          if (!response.ok) {
            result.value = `Error: ${data.error || 'Unknown error'}`;
            rulesLogic.value = 'Error while extracting rules/logic.';
            return;
          }

          result.value = data.result;
          rulesLogic.value = JSON.stringify({
            business_rules: data.business_rules,
            logic: data.logic
          }, null, 2);
          meta.textContent = `Confidence: ${data.confidence_score} | Assumptions: ${(data.assumptions || []).length}`;
        } catch (err) {
          result.value = `Error: ${err.message}`;
          rulesLogic.value = `Error: ${err.message}`;
        }
      });
    </script>
  </body>
</html>
